kind: app
version: 0.1.5
app:
  description: è©•ä¾¡ãƒ‡ãƒ¼ã‚¿ã‚’å…¥åŠ›ã™ã‚‹ã¨ã€å€‹åˆ¥åŒ–ã•ã‚ŒãŸãƒªãƒãƒ“ãƒªãƒ†ãƒ¼ã‚·ãƒ§ãƒ³è¨ˆç”»æ›¸ã‚’è‡ªå‹•ç”Ÿæˆã™ã‚‹ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã€‚
  icon: ğŸƒ
  icon_background: '#F3E5F5'
  mode: workflow
  name: 'AIS-49: ãƒªãƒãƒ“ãƒªãƒ†ãƒ¼ã‚·ãƒ§ãƒ³è¨ˆç”»æ›¸ç”Ÿæˆ'
  use_icon_as_answer_icon: false
workflow:
  environment_variables: []
  conversation_variables: []
  features:
    file_upload:
      image:
        enabled: false
        number_limits: 3
        transfer_methods:
        - local_file
        - remote_url
    opening_statement: ''
    retriever_resource:
      enabled: false
    sensitive_word_avoidance:
      enabled: true
      type: keywords
      config:
        keywords: |-
          çˆ†å¼¾
          æ®ºå®³
          é•æ³•è–¬ç‰©
          ãƒãƒƒã‚­ãƒ³ã‚°æ‰‹æ³•
        inputs_config:
          enabled: true
          preset_response: ãã®å†…å®¹ã«ã¯ãŠç­”ãˆã§ãã¾ã›ã‚“ã€‚åˆ¥ã®è³ªå•ã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚
        outputs_config:
          enabled: true
          preset_response: é©åˆ‡ãªå›ç­”ã‚’ç”Ÿæˆã§ãã¾ã›ã‚“ã§ã—ãŸã€‚è³ªå•ã‚’å¤‰ãˆã¦ãã ã•ã„ã€‚
    speech_to_text:
      enabled: false
    suggested_questions: []
    suggested_questions_after_answer:
      enabled: false
    text_to_speech:
      enabled: false
      language: ''
      voice: ''
  graph:
    edges:
    - data:
        sourceType: start
        targetType: code
        isInIteration: false
      id: e-54900000000001-54900000000002
      source: '54900000000001'
      sourceHandle: source
      target: '54900000000002'
      targetHandle: target
      type: custom
    - data:
        sourceType: code
        targetType: if-else
        isInIteration: false
      id: e-54900000000002-54900000000003
      source: '54900000000002'
      sourceHandle: source
      target: '54900000000003'
      targetHandle: target
      type: custom
    - data:
        sourceType: if-else
        targetType: llm
        isInIteration: false
      id: e-54900000000003-54900000000004
      source: '54900000000003'
      sourceHandle: 'true'
      target: '54900000000004'
      targetHandle: target
      type: custom
    - data:
        sourceType: if-else
        targetType: template-transform
        isInIteration: false
      id: e-54900000000003-54900000000006
      source: '54900000000003'
      sourceHandle: 'false'
      target: '54900000000006'
      targetHandle: target
      type: custom
    - data:
        sourceType: llm
        targetType: template-transform
        isInIteration: false
      id: e-54900000000004-54900000000005
      source: '54900000000004'
      sourceHandle: source
      target: '54900000000005'
      targetHandle: target
      type: custom
    - data:
        sourceType: template-transform
        targetType: end
        isInIteration: false
      id: e-54900000000005-54900000000007
      source: '54900000000005'
      sourceHandle: source
      target: '54900000000007'
      targetHandle: target
      type: custom
    - data:
        sourceType: template-transform
        targetType: end
        isInIteration: false
      id: e-54900000000006-54900000000007
      source: '54900000000006'
      sourceHandle: source
      target: '54900000000007'
      targetHandle: target
      type: custom
    nodes:
    - data:
        desc: å…¥åŠ›ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚‹
        selected: false
        title: é–‹å§‹
        type: start
        variables:
        - label: assessment_data
          variable: assessment_data
          required: true
          type: paragraph
          max_length: 30000
          options: []
        - label: rehab_type
          variable: rehab_type
          required: true
          type: select
          max_length: 48
          options:
          - è„³è¡€ç®¡ç–¾æ‚£ãƒªãƒ
          - é‹å‹•å™¨ãƒªãƒ
          - å‘¼å¸å™¨ãƒªãƒ
          - å¿ƒå¤§è¡€ç®¡ãƒªãƒ
          - å»ƒç”¨ç—‡å€™ç¾¤ãƒªãƒ
          - ãŒã‚“ãƒªãƒ
          - å°å…ãƒªãƒ
        - label: rehab_phase
          variable: rehab_phase
          required: true
          type: select
          max_length: 48
          options:
          - æ€¥æ€§æœŸ
          - å›å¾©æœŸ
          - ç¶­æŒæœŸ/ç”Ÿæ´»æœŸ
          - é€šæ‰€ãƒªãƒ
          - è¨ªå•ãƒªãƒ
        - label: patient_goals
          variable: patient_goals
          required: false
          type: paragraph
          max_length: 5000
          options: []
      height: 149
      id: '54900000000001'
      position:
        x: 80
        y: 282
      positionAbsolute:
        x: 80
        y: 282
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 243
    - data:
        desc: å…¥åŠ›ãƒ†ã‚­ã‚¹ãƒˆã®æ¤œè¨¼ã¨ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³æ¤œå‡ºã‚’è¡Œã†
        selected: false
        title: å…¥åŠ›æ¤œè¨¼
        type: code
        code_language: python3
        code: |-
          import re

          def main(assessment_data: str, patient_goals: str) -> dict:
              issues = []
              if len(assessment_data.strip()) < 20:
                  issues.append("å…¥åŠ›ãŒçŸ­ã™ãã¾ã™ï¼ˆ20æ–‡å­—ä»¥ä¸Šå¿…è¦ï¼‰")
              injection_patterns = [
                  r'(?i)ignore\s+(previous|above|all)\s+(instructions?|prompts?)',
                  r'(?i)system\s*prompt',
                  r'(?i)you\s+are\s+now',
                  r'(?i)forget\s+(everything|all|your)',
                  r'<script',
                  r'javascript:',
                  r'\{\{.*\}\}',
              ]
              combined = assessment_data + ' ' + patient_goals
              for pattern in injection_patterns:
                  if re.search(pattern, combined):
                      issues.append("ä¸æ­£ãªå…¥åŠ›ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸã€‚æ­£ã—ã„å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚")
                      break

              is_valid = "true" if len(issues) == 0 else "false"
              error_message = "" if is_valid == "true" else "\n".join(issues)
              return {'is_valid': is_valid, 'error_message': error_message}
        variables:
        - value_selector:
          - '54900000000001'
          - assessment_data
          variable: assessment_data
        - value_selector:
          - '54900000000001'
          - patient_goals
          variable: patient_goals
        outputs:
          is_valid:
            type: string
          error_message:
            type: string
      height: 97
      id: '54900000000002'
      position:
        x: 380
        y: 282
      positionAbsolute:
        x: 380
        y: 282
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 243
    - data:
        desc: å…¥åŠ›æ¤œè¨¼çµæœã§åˆ†å²ã™ã‚‹
        selected: false
        title: æ¤œè¨¼çµæœåˆ†å²
        type: if-else
        cases:
        - case_id: 'true'
          logical_operator: and
          conditions:
          - id: cond_valid
            variable_selector:
            - '54900000000002'
            - is_valid
            comparison_operator: is
            value: 'true'
      height: 125
      id: '54900000000003'
      position:
        x: 680
        y: 282
      positionAbsolute:
        x: 680
        y: 282
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 243
    - data:
        desc: è©•ä¾¡ãƒ‡ãƒ¼ã‚¿ã‚’å…¥åŠ›ã™ã‚‹ã¨ã€å€‹åˆ¥åŒ–ã•ã‚ŒãŸãƒªãƒãƒ“ãƒªãƒ†ãƒ¼ã‚·ãƒ§ãƒ³è¨ˆç”»æ›¸ã‚’è‡ªå‹•ç”Ÿæˆã™ã‚‹ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã€‚
        selected: false
        title: AIç”Ÿæˆ
        type: llm
        context:
          enabled: false
          variable_selector: []
        model:
          completion_params:
            frequency_penalty: 0
            max_tokens: 8192
            presence_penalty: 0
            temperature: 0.2
            top_p: 1
          mode: chat
          name: gpt-4o-mini
          provider: openai
        prompt_template:
        - role: system
          text: |-
            ã‚ãªãŸã¯ãƒªãƒãƒ“ãƒªãƒ†ãƒ¼ã‚·ãƒ§ãƒ³åŒ»ç™‚ã®å°‚é–€å®¶ï¼ˆç†å­¦ç™‚æ³•å£«ãƒ»ä½œæ¥­ç™‚æ³•å£«ãƒ»è¨€èªè´è¦šå£«ï¼‰ã§ã™ã€‚åšç”ŸåŠ´åƒçœã®ã€Œãƒªãƒãƒ“ãƒªãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ç·åˆå®Ÿæ–½è¨ˆç”»æ›¸ã€ã®æ›¸å¼ãŠã‚ˆã³å„ç–¾æ‚£åˆ¥ãƒªãƒã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã«æº–æ‹ ã—ãŸãƒªãƒãƒ“ãƒªãƒ†ãƒ¼ã‚·ãƒ§ãƒ³è¨ˆç”»æ›¸ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚

            ## å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
            ### 1. æ‚£è€…æƒ…å ±ãƒ»åŸºæœ¬æƒ…å ±
            - ç–¾æ‚£å / ç™ºç—‡æ—¥ / ãƒªãƒé–‹å§‹æ—¥ / ãƒªãƒåŒºåˆ†

            ### 2. è©•ä¾¡çµæœ
            #### æ©Ÿèƒ½è©•ä¾¡
            | è©•ä¾¡é …ç›® | è©•ä¾¡å°ºåº¦ | ç¾åœ¨å€¤ | ç›®æ¨™å€¤ |
            |---|---|---|---|
            | ADL | FIM/Barthel Index | | |
            | é‹å‹•æ©Ÿèƒ½ | MMT/ROM | | |
            | ãƒãƒ©ãƒ³ã‚¹ | Berg Balance Scale | | |
            | æ­©è¡Œ | FAC/10mæ­©è¡Œ | | |
            | èªçŸ¥æ©Ÿèƒ½ | MMSE/HDS-R | | |
            | åš¥ä¸‹æ©Ÿèƒ½ | FILS/RSST | | |

            #### ICFï¼ˆå›½éš›ç”Ÿæ´»æ©Ÿèƒ½åˆ†é¡ï¼‰ã«åŸºã¥ãæ•´ç†
            - å¿ƒèº«æ©Ÿèƒ½ãƒ»èº«ä½“æ§‹é€ 
            - æ´»å‹•
            - å‚åŠ 
            - ç’°å¢ƒå› å­
            - å€‹äººå› å­

            ### 3. å•é¡Œç‚¹ãƒªã‚¹ãƒˆ
            | # | å•é¡Œç‚¹ | è¦å›  | å„ªå…ˆåº¦ |

            ### 4. ç›®æ¨™è¨­å®š
            - **çŸ­æœŸç›®æ¨™**ï¼ˆ2é€±é–“ã€œ1ãƒ¶æœˆï¼‰:
            - **é•·æœŸç›®æ¨™**ï¼ˆ3ãƒ¶æœˆã€œ6ãƒ¶æœˆï¼‰:
            - **é€€é™¢/çµ‚äº†ç›®æ¨™**:

            ### 5. ãƒªãƒãƒ“ãƒªãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãƒ—ãƒ­ã‚°ãƒ©ãƒ 
            | # | ãƒ—ãƒ­ã‚°ãƒ©ãƒ  | é »åº¦ | æ™‚é–“ | å¼·åº¦ | ç›®çš„ |
            |---|---|---|---|---|---|

            ### 6. ãƒªã‚¹ã‚¯ç®¡ç†
            - é‹å‹•æ™‚ã®æ³¨æ„äº‹é …ï¼ˆè¡€åœ§ãƒ»å¿ƒæ‹æ•°ã®åŸºæº–ï¼‰
            - è»¢å€’äºˆé˜²ç­–
            - ä¸­æ­¢åŸºæº–

            ### 7. å¤šè·ç¨®é€£æºäº‹é …
            - åŒ»å¸«ã¸ã®å ±å‘Šãƒ»ç›¸è«‡äº‹é …
            - çœ‹è­·å¸«ã¨ã®é€£æºäº‹é …
            - MSWï¼ˆé€€é™¢æ”¯æ´ï¼‰ã¨ã®é€£æº

            ### 8. é€€é™¢å¾Œã®è¨ˆç”»
            - è‡ªä¸»ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ—ãƒ­ã‚°ãƒ©ãƒ 
            - åœ¨å®…ç’°å¢ƒèª¿æ•´ã®ææ¡ˆ
            - ä»‹è­·ä¿é™ºã‚µãƒ¼ãƒ“ã‚¹ã®åˆ©ç”¨ææ¡ˆ

            ## ãƒ«ãƒ¼ãƒ«
            - ICFï¼ˆå›½éš›ç”Ÿæ´»æ©Ÿèƒ½åˆ†é¡ï¼‰ã®æ çµ„ã¿ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨
            - ãƒªãƒãƒ“ãƒªåŒºåˆ†ï¼ˆç–¾æ‚£åˆ¥ï¼‰ã«å¿œã˜ãŸè¨ˆç”»ã«ã™ã‚‹ã“ã¨
            - SMARTç›®æ¨™ï¼ˆå…·ä½“çš„ãƒ»æ¸¬å®šå¯èƒ½ãƒ»é”æˆå¯èƒ½ãƒ»é–¢é€£æ€§ãƒ»æœŸé™ï¼‰ã‚’è¨­å®šã™ã‚‹ã“ã¨
            - ã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹ã«åŸºã¥ããƒªãƒãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’é¸æŠã™ã‚‹ã“ã¨
            - æ‚£è€…ãƒ»å®¶æ—ã®å¸Œæœ›ã‚’åæ˜ ã™ã‚‹ã“ã¨
            - ãƒªã‚¹ã‚¯ç®¡ç†ã‚’å¿…ãšå«ã‚ã‚‹ã“ã¨
            - ç®—å®šè¦ä»¶ï¼ˆæ–½è¨­åŸºæº–ãƒ»å®Ÿæ–½å˜ä½æ•°ï¼‰ã‚’è€ƒæ…®ã™ã‚‹ã“ã¨
            - åŒ»å¸«ã®æœ€çµ‚ç¢ºèªãŒå¿…è¦ãªæ—¨ã‚’æ˜è¨˜ã™ã‚‹ã“ã¨
        - role: user
          text: |-
            assessment_data:
            {{#54900000000001.assessment_data#}}

            rehab_type: {{#54900000000001.rehab_type#}}

            rehab_phase: {{#54900000000001.rehab_phase#}}

            patient_goals:
            {{#54900000000001.patient_goals#}}
        variables: []
        vision:
          enabled: false
      height: 97
      id: '54900000000004'
      position:
        x: 980
        y: 182
      positionAbsolute:
        x: 980
        y: 182
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 243
    - data:
        desc: ç”Ÿæˆçµæœã«ãƒ¡ã‚¿æƒ…å ±ã‚’ä»˜ä¸ã—ã¦æ•´å½¢ã™ã‚‹
        selected: false
        title: å‡ºåŠ›æ•´å½¢
        type: template-transform
        template: |-
          # ãƒªãƒãƒ“ãƒªãƒ†ãƒ¼ã‚·ãƒ§ãƒ³è¨ˆç”»æ›¸

          **rehab_type**: {{ rehab_type }}
          **rehab_phase**: {{ rehab_phase }}

          ---

          {{ result }}

          ---
          *AIãŒç”Ÿæˆã—ãŸãƒªãƒãƒ“ãƒªè¨ˆç”»æ›¸ã®ãƒ‰ãƒ©ãƒ•ãƒˆã§ã™ã€‚ãƒªãƒåŒ»å¸«ãƒ»æ‹…å½“ã‚»ãƒ©ãƒ”ã‚¹ãƒˆã®ç¢ºèªã‚’çµŒã¦ã‹ã‚‰æ­£å¼æ–‡æ›¸åŒ–ã—ã¦ãã ã•ã„ã€‚åŒ»ç™‚è¡Œç‚ºã®ä»£æ›¿ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚*
        variables:
        - value_selector:
          - '54900000000004'
          - text
          variable: result
        - value_selector:
          - '54900000000001'
          - rehab_type
          variable: rehab_type
        - value_selector:
          - '54900000000001'
          - rehab_phase
          variable: rehab_phase
      height: 97
      id: '54900000000005'
      position:
        x: 1280
        y: 182
      positionAbsolute:
        x: 1280
        y: 182
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 243
    - data:
        desc: å…¥åŠ›æ¤œè¨¼ã‚¨ãƒ©ãƒ¼æ™‚ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ•´å½¢ã™ã‚‹
        selected: false
        title: ã‚¨ãƒ©ãƒ¼å¿œç­”
        type: template-transform
        template: |-
          ## å…¥åŠ›ã‚¨ãƒ©ãƒ¼

          ãƒªãƒãƒ“ãƒªãƒ†ãƒ¼ã‚·ãƒ§ãƒ³è¨ˆç”»æ›¸ç”Ÿæˆã®å‡¦ç†ã‚’é–‹å§‹ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚

          **ã‚¨ãƒ©ãƒ¼è©³ç´°**: {{ error_message }}

          å…¥åŠ›å†…å®¹ã‚’ä¿®æ­£ã—ã¦å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚
        variables:
        - value_selector:
          - '54900000000002'
          - error_message
          variable: error_message
      height: 97
      id: '54900000000006'
      position:
        x: 980
        y: 432
      positionAbsolute:
        x: 980
        y: 432
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 243
    - data:
        desc: çµæœã¾ãŸã¯ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‡ºåŠ›ã™ã‚‹
        selected: false
        title: çµ‚äº†
        type: end
        outputs:
        - value_selector:
          - '54900000000005'
          - output
          variable: result
        - value_selector:
          - '54900000000006'
          - output
          variable: error_message
      height: 89
      id: '54900000000007'
      position:
        x: 1580
        y: 282
      positionAbsolute:
        x: 1580
        y: 282
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 243
    viewport:
      x: 0
      y: 0
      zoom: 1
